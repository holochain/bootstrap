name: deploy

on:
 push:
  branches:
   - main
   - fix-deploy

jobs:
 deploy:
  name: deploy
  runs-on: ubuntu-latest
  strategy:
    matrix:
      include:
        - cf-env: neonphog
          token: ${{ secrets.CF_API_TOKEN_NEONPHOG }}
        #- cf-env: dev
        #  token: CF_API_TOKEN
        #- cf-env: production
        #  token: CF_API_TOKEN

  steps:
   - uses: actions/checkout@v2

   - uses: actions/setup-node@v2
     with:
       node-version: 16

   - run: npm ci

   - name: Deploy
     run: npx wrangler publish -e ${{ matrix.cf-env }}
     env:
       CF_API_TOKEN: ${{ matrix.token }}

   - name: ProxyPool
     run: npx wrangler -e neonphog kv:key put $'proxy_pool:kitsune-proxy://f3gH2VMkJ4qvZJOXx0ccL_Zo5n-s_CnBjSzAsEHHDCA/kitsune-quic/h/137.184.142.208/p/5788/--' "1" --binding BOOTSTRAP
     env:
       CF_API_TOKEN: ${{ matrix.token }}

   #- name: Deploy:Dev
   #  run: npx wrangler publish -e dev
   #  env:
   #    CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}

   #- name: Deploy:Production
   #  run: npx wrangler publish -e production
   #  env:
   #    CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
